# Testplan och testfall: Webbapplikation för digital tillsyn

**Version:** 1.0
**Datum:** 2024-05-27 _(Ersätt med aktuellt datum)_

## 1. Introduktion

### 1.1 Syfte
Syftet med detta dokument är att beskriva teststrategin, testtyper och en uppsättning representativa testfall för webbapplikationen för digital tillsyn. Målet är att säkerställa applikationens funktionalitet, tillförlitlighet, användbarhet och överensstämmelse med den tekniska specifikationen.

### 1.2 Omfattning
Denna testplan täcker testning av applikationens alla kärnfunktioner, användargränssnitt, datahantering, och tillgänglighetsaspekter. Den inkluderar förslag på olika testnivåer.

### 1.3 Målgrupp
Detta dokument riktar sig till utvecklare, testare och kvalitetssäkringsansvariga.

## 2. Teststrategi

### 2.1 Testnivåer
Följande testnivåer kommer att tillämpas:
*   **Enhetstester:** (Om tillämpligt och resurser finns) Testning av enskilda javascript-funktioner och moduler isolerat, särskilt för komplex logik i `audit_logic.js` och `validation_logic.js`.
*   **Komponenttester:** Manuell eller (om möjligt) automatiserad testning av enskilda ui-komponenters rendering, grundläggande interaktioner och databindning.
*   **Integrationstester:** Verifiering av att olika komponenter och moduler interagerar korrekt med varandra (t.ex. hur `AuditOverviewComponent` använder `SampleListComponent` och `AddSampleFormComponent`).
*   **Systemtester / End-to-End (E2E) tester:** Testning av kompletta användarflöden genom hela applikationen, från start till export. Detta är den primära testformen för denna applikation.
*   **Användbarhetstester:** (Rekommenderas) Utförs med representativa slutanvändare för att identifiera problem med användarvänlighet, intuitivitet och effektivitet i arbetsflöden.
*   **Tillgänglighetstester:** Systematisk testning mot wcag 2.2 aa-kraven med hjälp av en kombination av automatiska verktyg, manuell tangentbordsnavigering och testning med skärmläsare.
*   **Regressionstester:** En utvald uppsättning av kritiska testfall (främst systemtester) som körs om efter varje betydande kodändring för att säkerställa att befintlig funktionalitet inte har påverkats negativt.

### 2.2 Testmiljö
*   **Webbläsare:** Testning ska primärt ske på de senaste stabila versionerna av Google Chrome, Mozilla Firefox och Microsoft Edge.
*   **Operativsystem:** Testning bör övervägas på både Windows och macOS.
*   **Lokal körning:** Applikationen körs från lokala filer via en enkel http-server.

### 2.3 Testdata
*   **Regelfiler:** Minst en omfattande och korrekt formaterad json-regelfil. En regelfil med avsiktliga fel för att testa validering. En minimal regelfil.
*   **Sparade granskningsfiler:** Exempel på sparade granskningsfiler i olika stadier (nystartad, pågående, låst). En korrupt sparad fil för att testa felladdning.
*   **Stickprovsdata:** Variation i antal stickprov, sidtyper och innehållstyper.

### 2.4 Testverktyg (förslag)
*   **Webbläsarens utvecklarverktyg:** För inspektion, felsökning och konsolloggning.
*   **Tillgänglighetsverktyg:** Axe DevTools (webbläsartillägg), WAVE (webbläsartillägg), Lighthouse (inbyggt i Chrome).
*   **Skärmläsare:** NVDA (Windows), VoiceOver (macOS), JAWS (om licens finns).
*   **JSON-validerare:** Onlineverktyg eller inbyggda i kodredigerare för att verifiera regelfiler.

## 3. Testfall

Nedan följer exempel på testfall, grupperade efter funktionsområde. Varje testfall bör idealiskt ha ett unikt ID, beskrivning, förutsättningar, teststeg, förväntat resultat och faktiskt resultat (vid exekvering).

### 3.1 Initialisering och filhantering

| Testfalls-ID | Beskrivning                                                              | Förutsättningar                                     | Teststeg                                                                                                | Förväntat resultat                                                                                                                               |
|--------------|--------------------------------------------------------------------------|----------------------------------------------------|---------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_FH_001    | Ladda upp giltig json-regelfil                                           | Startvyn visas. Giltig regelfil finns.             | 1. Klicka "Starta ny granskning". 2. Välj giltig regelfil.                                              | Meddelande om lyckad laddning. Navigering till metadata-vyn. `current_audit.ruleFileContent` är satt.                                              |
| TC_FH_002    | Ladda upp fil som inte är json                                           | Startvyn visas.                                    | 1. Klicka "Starta ny granskning". 2. Välj en `.txt`-fil.                                                | Felmeddelande visas ("Filen måste vara i JSON-format."). Ingen navigering. Filinput nollställs.                                                    |
| TC_FH_003    | Ladda upp json-fil med felaktigt schema (t.ex. saknar `metadata`)          | Startvyn visas. Felaktig regelfil finns.           | 1. Klicka "Starta ny granskning". 2. Välj felaktig regelfil.                                            | Specifikt felmeddelande visas om schemavalideringsfel. Ingen navigering. Filinput nollställs.                                                |
| TC_FH_004    | Ladda giltig sparad granskningsfil                                       | Startvyn visas. Giltig sparad granskningsfil finns. | 1. Klicka "Ladda upp pågående granskning". 2. Välj giltig sparad fil.                                   | Meddelande om lyckad laddning. Applikationen återställer tillståndet. Navigering till granskningsöversikt.                                         |
| TC_FH_005    | Ladda korrupt/ogiltig sparad granskningsfil                              | Startvyn visas. Korrupt fil finns.                 | 1. Klicka "Ladda upp pågående granskning". 2. Välj korrupt fil.                                         | Felmeddelande visas ("Den valda filen är inte en giltig..."). Ingen navigering. Filinput nollställs.                                                |
| TC_FH_006    | Spara pågående granskning till fil                                       | En granskning är pågående eller låst.               | 1. Navigera till granskningsöversikt. 2. Klicka "Spara granskning till fil".                               | En json-fil laddas ner. Filnamnet är dynamiskt genererat. Innehållet i filen matchar `current_audit`-objektet.                                  |
| TC_FH_007    | Ladda sparad fil skapad med nyare app-version                            | Startvyn visas. Sparad fil med högre `saveFileVersion`. | 1. Ladda filen.                                                                                         | Varning visas om versionsskillnad. Filen laddas och appen försöker återställa tillståndet.                                                            |

### 3.2 Metadata-inmatning

| Testfalls-ID | Beskrivning                                            | Förutsättningar                               | Teststeg                                                                       | Förväntat resultat                                                                                              |
|--------------|--------------------------------------------------------|-----------------------------------------------|--------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| TC_MD_001    | Mata in data i alla metadatafält                       | Ny granskning startad, metadata-vyn visas.    | 1. Fyll i alla fält. 2. Klicka "Fortsätt till stickprov".                      | Data sparas korrekt i `current_audit.auditMetadata`. Navigering sker.                                           |
| TC_MD_002    | Lämna alla metadatafält tomma                          | Ny granskning startad, metadata-vyn visas.    | 1. Klicka "Fortsätt till stickprov" utan att fylla i fält.                     | Navigering sker (fälten är frivilliga). Metadata-objektet är tomt eller har tomma strängar.                       |
| TC_MD_003    | Försök redigera metadata efter granskningsstart        | Granskning har status `in_progress` eller `locked`. | 1. Navigera (om möjligt) till metadata-vyn.                                  | Fälten visas som skrivskyddade. Ingen möjlighet att spara ändringar.                                              |
| TC_MD_004    | Mata in giltig url i "Länk till aktör"                 | Metadata-vyn visas.                           | 1. Ange "www.exempel.com". 2. Spara.                                           | Url:en sparas, "https://" läggs till automatiskt om det saknas.                                                   |

### 3.3 Stickprovshantering (Initialt - `SampleManagementViewComponent`)

| Testfalls-ID | Beskrivning                                                     | Förutsättningar                                       | Teststeg                                                                                                                                   | Förväntat resultat                                                                                                                                                              |
|--------------|-----------------------------------------------------------------|-------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_SM_001    | Lägg till nytt stickprov med all obligatorisk data              | Metadata-vyn avklarad, stickprovshanteringsvyn visas. | 1. Öppna formulär. 2. Välj sidtyp. 3. Ange beskrivning. 4. Välj minst en innehållstyp. 5. Spara.                                                 | Stickprovet läggs till i listan. Formuläret döljs/återställs. `current_audit.samples` uppdateras.                                                                                    |
| TC_SM_002    | Försök spara stickprov utan sidtyp                              | Stickprovshanteringsvyn visas, formulär öppet.        | 1. Ange beskrivning, välj innehållstyp. 2. Lämna sidtyp tom. 3. Spara.                                                                       | Felmeddelande ("Sidtyp är obligatoriskt."). Stickprovet sparas inte. Fokus på sidtypsfältet.                                                                                         |
| TC_SM_003    | Försök spara stickprov utan beskrivning                         | Stickprovshanteringsvyn visas, formulär öppet.        | 1. Välj sidtyp, välj innehållstyp. 2. Lämna beskrivning tom. 3. Spara.                                                                      | Felmeddelande ("Beskrivning är obligatoriskt."). Stickprovet sparas inte. Fokus på beskrivningsfältet.                                                                             |
| TC_SM_004    | Försök spara stickprov utan innehållstyp                        | Stickprovshanteringsvyn visas, formulär öppet.        | 1. Välj sidtyp, ange beskrivning. 2. Välj ingen innehållstyp. 3. Spara.                                                                   | Felmeddelande ("Minst en innehållstyp måste väljas."). Stickprovet sparas inte. Fokus på första innehållstyps-checkbox.                                                               |
| TC_SM_005    | Redigera befintligt stickprov                                   | Minst ett stickprov finns.                              | 1. Klicka "Redigera stickprov". 2. Ändra beskrivning. 3. Spara.                                                                              | Formuläret visas med korrekt data. Ändringen sparas. Listan uppdateras.                                                                                                            |
| TC_SM_006    | Radera stickprov (när >1 finns)                                 | Minst två stickprov finns.                              | 1. Klicka "Radera stickprov" på ett stickprov. 2. Bekräfta i dialog.                                                                        | Stickprovet tas bort från listan och `current_audit.samples`.                                                                                                                     |
| TC_SM_007    | Försök radera sista stickprovet                                 | Endast ett stickprov finns.                             | 1. Observera raderingsknappen för det enda stickprovet.                                                                                      | Raderingsknappen ska inte renderas/vara tillgänglig.                                                                                                                               |
| TC_SM_008    | Starta granskning (inaktiv knapp)                               | Inga stickprov tillagda.                                | 1. Observera "Starta granskning"-knappen.                                                                                                   | Knappen är inte aktiv/renderas inte.                                                                                                                                             |
| TC_SM_009    | Starta granskning (aktiv knapp)                                 | Minst ett stickprov tillagt.                            | 1. Klicka "Starta granskning".                                                                                                             | `auditStatus` ändras till `in_progress`. `startTime` sätts. Navigering till granskningsöversikt. Metadata blir skrivskyddad.                                                     |

### 3.4 Stickprovshantering (Pågående granskning - `AuditOverviewComponent`)

| Testfalls-ID | Beskrivning                                                        | Förutsättningar                                   | Teststeg                                                                                                     | Förväntat resultat                                                                                                                                                         |
|--------------|--------------------------------------------------------------------|---------------------------------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_SM_AO_001 | (Status `in_progress`) Visa "Lägg till nytt stickprov"-knapp         | Granskning `in_progress`. Granskningsöversikt visas. | 1. Observera området för stickprovslistan.                                                                   | Knappen "Lägg till nytt stickprov" visas.                                                                                                                                |
| TC_SM_AO_002 | (Status `in_progress`) Lägg till nytt stickprov                      | Som TC_SM_AO_001.                                   | 1. Klicka "Lägg till nytt stickprov". 2. Fyll i formuläret korrekt. 3. Spara.                                   | Formuläret visas. Stickprovet läggs till i `current_audit.samples`. Listan i översikten uppdateras. Rubrik med antal stickprov uppdateras. Formuläret döljs.                |
| TC_SM_AO_003 | (Status `in_progress`) Redigera stickprov                            | Granskning `in_progress`. Minst ett stickprov finns. | 1. Klicka "Redigera stickprov" på ett stickprov. 2. Ändra data. 3. Spara.                                     | Formuläret visas med korrekt data. Ändringar sparas. Listan i översikten uppdateras. Formuläret döljs.                                                                   |
| TC_SM_AO_004 | (Status `in_progress`) Radera stickprov (>1 kvar)                    | Granskning `in_progress`. Minst två stickprov finns. | 1. Klicka "Radera stickprov". 2. Bekräfta.                                                                    | Bekräftelsedialog visas. Fokus hanteras. Stickprovet tas bort. Listan och rubrik med antal uppdateras. Fokus återställs.                                                |
| TC_SM_AO_005 | (Status `in_progress`) Försök radera sista stickprovet               | Granskning `in_progress`. Ett stickprov finns.     | 1. Observera/försök klicka "Radera stickprov".                                                               | Raderingsknappen renderas inte för det sista stickprovet. Om man försöker via kod, ska en varning visas/inget hända.                                                          |
| TC_SM_AO_006 | (Status `locked`) Försök visa "Lägg till/Redigera/Radera"-alternativ | Granskning `locked`. Granskningsöversikt visas.     | 1. Observera stickprovslistan och dess knappar.                                                              | Knapparna "Lägg till nytt stickprov", "Redigera stickprov", "Radera stickprov" ska inte vara synliga/tillgängliga.                                                            |

### 3.5 Kravgranskning (`RequirementListComponent` & `RequirementAuditComponent`)

| Testfalls-ID | Beskrivning                                                                 | Förutsättningar                                                | Teststeg                                                                                                                                                               | Förväntat resultat                                                                                                                                                                 |
|--------------|-----------------------------------------------------------------------------|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_RA_001    | Navigera till kravlistan                                                    | Granskning `in_progress`. Stickprov valt i översikt.             | 1. Klicka "Visa alla krav" för ett stickprov.                                                                                                                          | Kravlistvyn visas med korrekta krav för stickprovet, grupperade och sorterade. Stickprovsinfo och progress visas.                                                                   |
| TC_RA_002    | Navigera till enskilt krav                                                  | Kravlistvyn visas.                                             | 1. Klicka på en kravtitel.                                                                                                                                             | Kravgranskningsvyn visas med korrekt kravdata.                                                                                                                                      |
| TC_RA_003    | Bedöm kontrollpunkt: "Stämmer", sedan ett godkännandekriterium som "Godkänt"  | Kravgranskningsvyn. Kontrollpunkt med kriterier. Granskning ej låst. | 1. Klicka "Stämmer". 2. Klicka "Godkänt" för ett kriterium.                                                                                                              | Kontrollpunktens status blir "Delvis granskad" (om fler kriterier finns) eller "Godkänd" (om det var sista/enda). Kravets status uppdateras.                                         |
| TC_RA_004    | Bedöm kontrollpunkt: "Stämmer", sedan ett godkännandekriterium som "Underkänt" | Som TC_RA_003.                                                 | 1. Klicka "Stämmer". 2. Klicka "Underkänt" för ett kriterium.                                                                                                          | Kontrollpunktens status blir "Underkänd". Kravets status blir "Underkänt".                                                                                                              |
| TC_RA_005    | Bedöm kontrollpunkt: "Stämmer inte"                                         | Kravgranskningsvyn. Granskning ej låst.                           | 1. Klicka "Stämmer inte".                                                                                                                                              | Kontrollpunktens status blir "Godkänd" (eftersom villkoret ej var applicerbart). Underliggande kriterier (om några) visas inte/är irrelevanta. Kravets status uppdateras.          |
| TC_RA_006    | Mata in observationer och kommentarer                                       | Kravgranskningsvyn. Granskning ej låst.                           | 1. Skriv text i fälten "Faktisk observation", "Kommentar till granskare", "Kommentar till aktör". 2. Lämna fältet (blur) eller navigera.                               | Texten sparas i `current_audit.samples[...].requirementResults`. Verifiera genom att ladda om vyn eller inspektera `sessionStorage`.                                                   |
| TC_RA_007    | Använd navigeringsknappar (Föregående, Nästa, Nästa ohanterade)             | Kravgranskningsvyn. Flera krav finns för stickprovet.             | 1. Klicka "Nästa krav". 2. Klicka "Föregående krav". 3. Klicka "Nästa ohanterade krav".                                                                                   | Korrekt navigering sker. Knapparna visas/döljs korrekt baserat på position och status.                                                                                                 |
| TC_RA_008    | Försök redigera när granskning är låst                                      | Kravgranskningsvyn. Granskning `locked`.                          | 1. Försök klicka på statusknappar. 2. Försök skriva i textfält.                                                                                                       | Inga ändringar kan göras. Knappar är inaktiva/renderas inte. Textfält är skrivskyddade.                                                                                                |

### 3.6 Låsning, Upplåsning och Export

| Testfalls-ID | Beskrivning                          | Förutsättningar                               | Teststeg                                               | Förväntat resultat                                                                                                                             |
|--------------|--------------------------------------|-----------------------------------------------|--------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_LE_001    | Lås pågående granskning              | Granskning `in_progress`. Översiktsvyn visas. | 1. Klicka "Lås och avsluta granskningen".              | Status ändras till `locked`. `endTime` sätts. Redigeringsmöjligheter (stickprov, krav) försvinner. Exportknappar visas.                       |
| TC_LE_002    | Lås upp låst granskning              | Granskning `locked`. Översiktsvyn visas.      | 1. Klicka "Lås upp granskning".                        | Status ändras till `in_progress`. `endTime` nollställs. Redigeringsmöjligheter återställs. Exportknappar döljs (eller låsknapp visas igen). |
| TC_LE_003    | Exportera till CSV (låst)            | Granskning `locked`.                          | 1. Klicka "Exportera till CSV".                        | En CSV-fil laddas ner med korrekt data.                                                                                                          |
| TC_LE_004    | Exportera till Excel (låst)          | Granskning `locked`.                          | 1. Klicka "Exportera till Excel".                      | En XLSX-fil laddas ner med korrekt data.                                                                                                         |
| TC_LE_005    | Försök exportera (ej låst)           | Granskning `in_progress`.                     | 1. Observera/försök hitta exportknappar.               | Exportknappar ska inte vara synliga/tillgängliga.                                                                                                |

### 3.7 Gränssnitt och Användarupplevelse (Exempel)

| Testfalls-ID | Beskrivning                             | Förutsättningar          | Teststeg                                                                 | Förväntat resultat                                                                                                                                      |
|--------------|-----------------------------------------|--------------------------|--------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| TC_UI_001    | Byt språk                               | Applikationen visas.     | 1. Välj ett annat språk i språkväljaren.                                 | All synlig UI-text uppdateras till det valda språket. Valet sparas.                                                                                       |
| TC_UI_002    | Byt tema (ljust/mörkt)                  | Applikationen visas.     | 1. Klicka på temaväxlaren.                                               | Färgschemat växlar. Ikonen på knappen uppdateras. Valet sparas.                                                                                             |
| TC_UI_003    | Responsivitet - Mobilt (ca 320px)       | Applikationen visas.     | 1. Ändra webbläsarfönstrets bredd till ca 320px. 2. Navigera genom vyer. | Layouten anpassas. All text är läsbar. All funktionalitet är tillgänglig. Inga element överlappar på ett störande sätt.                                      |
| TC_UI_004    | Tangentbordsnavigering - Huvudflöde     | Applikationen visas.     | 1. Använd Tab, Shift+Tab, Enter, Space för att navigera och interagera. | Alla interaktiva element är nåbara. Fokusordningen är logisk. Fokusindikatorn är tydlig. Funktioner kan aktiveras.                                         |
| TC_UI_005    | Skärmläsartest - Starta ny granskning   | Skärmläsare aktiv.       | 1. Låt skärmläsaren guida genom startvyn och processen att ladda regelfil. | Instruktioner, knappar och fält läses upp korrekt och är förståeliga.                                                                                   |
| TC_UI_006    | Fokushantering vid raderingsdialog      | Granskning `in_progress`.  | 1. Försök radera ett stickprov. 2. Interagera med bekräftelsedialogen.   | Fokus flyttas till dialogen. Fokus kan inte lämna dialogen med Tab. Fokus återställs till raderingsknappen (eller lämpligt element) när dialogen stängs. |

## 4. Rapportering av Testresultat

*   För varje testfall ska status (Godkänt, Underkänt, Blockerat, Ej kört) noteras.
*   Vid "Underkänt" ska steg för att reproducera felet, faktiskt resultat och förväntat resultat dokumenteras tydligt, gärna med skärmdumpar och eventuella felmeddelanden från konsolen.
*   Buggar rapporteras i lämpligt system (om sådant finns) eller direkt till utvecklingsteamet.

## 5. Testdatahantering

*   Skapa en uppsättning standardiserade regelfiler (en korrekt, en med avsiktliga fel) och sparade granskningsfiler som kan återanvändas för regressionstestning.
*   Dokumentera vilken testdata som används för specifika testfall om det är relevant.